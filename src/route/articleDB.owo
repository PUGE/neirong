<template lang="pug">
.article-db
  .loading
    img(src="@|loading.svg|")
  .left
    .left-item(o-for="this.data.list" o-tap="getInfo({value.id})") {value.tips}
  .right
</template>

<script>
  module.exports = {
    data: {
      list: []
    },
    created: function () {
      this.query('.loading').style.display = 'block'
      fetch(serverIP + `getArticle`, {
        method: 'GET',
        redirect: 'follow'
      }).then(response => response.json()).then(result => {
        console.log(result)
        if (result.err == 0) {
          this.data.list = result.data
          this.getInfo(result.data[0].id)
          setTimeout(() => {
            this.handleEvent(this, this.query('.left'))
          }, 0);
        }
      }).catch(error => console.log('error', error));
    },
    getInfo: function (id) {
      this.query('.loading').style.display = 'block'
      console.log(id)
      fetch(serverIP + `getArticleItem?id=${id}`, {
        method: 'GET',
        redirect: 'follow'
      }).then(response => response.json()).then(result => {
        console.log(result)
        if (result.err == 0) {
          this.query('.right').innerText = result.data.text
        }
        this.query('.loading').style.display = 'none'
      }).catch(error => console.log('error', error));
    }
  }
</script>

<style lang="less">
.article-db {
  display: flex;
}
.left {
  width: 240px;
  padding: 0 5px;
  height: 100%;
  overflow: auto;
}
.left-item {
  border-bottom: 1px solid #ccc;
  padding: 10px 0;
  cursor: pointer;
  line-height: 24px;
  a {
    font-weight: bold;
    color: #333;
  }
}
.right {
  width: calc(100% - 270px);
  padding: 10px;
  font-size: 18px;
  overflow: auto;
}
.loading {
  position: absolute;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.6);
  z-index: 9;
  display: none;
  img {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    margin: auto;
  }
}
</style>