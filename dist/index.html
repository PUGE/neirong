<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <!-- 页面的元信息 -->
    <title>测试预览页面</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=1000, user-scalable=yes"/>
    <meta name="format-detection" content="telephone=no, email=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="white"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="filetype" content="1"/>
    <meta name="publishedtype" content="1"/>
    <meta name="pagetype" content="2"/>
    <meta name="description" content="{TAG_59447_TAG}"/>
    <meta name="keywords" content="{TAG_59446_TAG}"/>
    <meta name="catalogs" content="{TAG_83943_TAG}"/>
    
      <!-- 页面主样式文件 -->
      <link charset="utf-8"  rel="stylesheet" href="./static/css/owo.core.css">
      
    <!-- 附属css文件 -->
    <link rel="stylesheet" href="./static/css/main.css" charset="utf-8">
      
  </head>
  <body>
    
    <!-- 页面[page]-->
    <div class="home page" template="page" style="display: block;"><div class="conn"><div class="left"><div class="logo">内容审核系统</div><div class="menu-box"><div class="menu-box-item" go="/view-content=checkText" o-class-active="this.view.content._activeName == 'checkText'"><div class="icon"></div><span>内容智能审查</span></div><div class="menu-box-item" go="/view-content=word" o-class-active="this.view.content._activeName == 'word'"><div class="icon"></div><span>关键词管理</span></div><div class="menu-box-item" go="/view-content=checkUrl" o-class-active="this.view.content._activeName == 'checkUrl'"><div class="icon"></div><span>网址内容监控</span></div></div></div><div class="router conn-box right clear" view="content"><div class="check-page router-item" route="checkText"><div class="check"><pre contenteditable="true"><p>报北京11月11日电  （记者冯春梅）全国政协十三届常委会第十四次会议11日在京闭幕。中共中央政治局常委、全国政协主席汪洋主持会议并讲话。</p><p>全国政协常委们高度评价“十三五”时期我国经济社会发展取得的巨大成就，完全赞成和拥护习近平总书记在中共十九届五中全会上的重要讲话和全会审议通过的规划建议，一致认为规划建议擘画蓝图鼓舞人心、制定目标实事求是、部署举措务实精准，是今后5年乃至更长时期我国经济社会发展的行动指南。大家表示，要自觉学习贯彻全会精神、对标对表全会要求，切实担负起政协委员的政治责任。</p><p>汪洋指出，深入学习宣传贯彻五中全会精神，是当前和今后一个时期人民政协的首要政治任务。要深入研究和深刻把握全面建设社会主义现代化国家的精髓要义，紧紧围绕中国式现代化人口规模巨大、全体人民共同富裕、物质文明和精神文明相协调、人与自然和谐共生、走和平发展道路等重要特征，发挥人民政协人才荟萃优势，深化对相关重大理论和实践问题的研究，更好为制定实施“十四五”规划纲要精准建言、凝心聚力。</p><p>汪洋强调，要按照五中全会部署要求，坚持制度引领，推动贯彻中央政协工作会议精神走深走实。要以制定政协协商工作规则为牵引，进一步提高专门协商机构协商履职水平；以实施加强和促进人民政协凝聚共识工作的意见为基础，进一步增强凝心聚力的实效；以强化委员责任担当为抓手，加强正向激励和纪律约束，进一步推动作风之实和履职之能有机结合。</p><p>会议审议通过了关于举办辛亥革命110周年纪念活动的决定、全国政协关于强化政协委员责任担当的意见，审议通过了修订后的政协全国委员会专门委员会通则等。</p><p>会议经过表决，增补王尔乘、李宝善、蔡名照为第十三届全国政协委员，李宝善、蔡名照为教科卫体委员会副主任，王尔乘为社会和法制委员会副主任；增补高波为第十三届全国政协副秘书长，不再担任人口资源环境委员会驻会副主任；接受蓝天立同志因工作原因请辞第十三届全国政协委员。</p><p>闭幕会前，国家发展改革委党组成员、国家粮食和物资储备局局长张务锋应邀作了题为“解决好中国人自己的‘饭碗’问题——我国粮食生产与粮食安全”学习讲座。</p><p>全国政协副主席张庆黎、刘奇葆、董建华、万钢、卢展工、王正伟、马飚、陈晓光、梁振英、夏宝龙、李斌、巴特尔、汪永清、苏辉、郑建邦、辜胜阻、刘新成、何维、邵鸿、高云龙出席会议。</p><p>洗金瓶 金瓶子 洗金子 习斤平 李克勤 锦秀山河 姗姗来迟 李x强 李xx 李33强 张克强 李xxxxx克强 王宝强 李/克/强 老李新买的手机仅500克很强！</p><p>王洋 汪洋 台独 态度 台堵 全国政协 全国正邪 邪不压正 正邪不两立 总书记 宗书记 同书记 书记处书记</p></pre><div class="right-bar"><div class="info-right"><div class="title clear"><span class="block">关键词标签：</span></div><div class="block-show-box clear"><div class="block-show" o-value="this.data.infoData.type"></div></div><div class="title clear"><span class="block">关键词拼音：</span></div><div class="block-show-box clear"><div class="block-show" o-for="this.data.infoData.pinyin">{value}</div></div><div class="title clear"><span>重点关键词：</span><div class="block-show" o-value="this.data.infoData.major"></div></div><div class="title clear" o-if="this.data.infoData.vague"><span>模糊匹配级别：</span><div class="block-show" o-value="this.data.infoData.vague"></div></div><div class="title clear" o-if="this.data.infoData.severity"><span>关键词重要度：</span><div class="block-show" o-value="this.data.infoData.severity"></div></div><div class="title clear" o-if="this.data.infoData.tips"><span class="block">其他信息：</span><div class="info-show" o-value="this.data.infoData.tips"></div></div><div class="fix-box" o-if="this.data.infoData.like"><div class="title clear"><span>正确的文字可能为?</span></div><div class="block-show-box clear"><div class="block-show" o-value="this.data.infoData.text"></div></div><div class="fix-button button-item" o-tap="autoFix"><span>(F)一键修复为 </span><soan o-value="this.data.infoData.text"></soan></div></div><div class="clear-box"><div class="clear-button button-item" o-tap="clear">清除此关键词标记</div></div><div class="type-box"></div><div class="button" o-tap="hideInfoRight">返回审核</div></div><div class="check-right"><div class="check-box"><input type="checkbox" o-value="this.data.sendData.base" disabled="true"><span>启用关键词匹配</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.pinyin"><span>启用拼音纠错</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.yange"><span>启用严格模式</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.network"><span>启用云词库匹配</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.chengyuBase"><span>启用成语匹配</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.chengyuPinyin"><span>启用成语纠错</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.mohu"><span>启用模糊纠错</span></div><div class="button" o-tap="check">智能审核</div></div></div></div></div><div class="word-box router-item" route="word"><div class="word"><div class="db-left-bar"><div class="db-item"><div class="icon"></div><span>关键词数据库</span></div></div><div class="cent-bar"><div class="table-box"></div><div class="pagination-box"></div></div><div class="right-bar"><div class="word-edit-box"><div class="word-edit-item"><div class="title">关键词</div><input type="text" o-value="this.data.edit.text"></div><div class="word-edit-item"><div class="title">关键词类型</div><select o-value="this.data.edit.type"><option value="Polity">政治</option><option value="Porn">色情</option><option value="Abuse">粗俗</option><option value="Terror">恐怖</option><option value="Ad">广告</option></select></div><div class="word-edit-item"><div class="title">重要性</div><select o-value="this.data.edit.major"><option value="0">普通</option><option value="1">重要</option></select></div><div class="word-edit-item"><div class="title">提示信息</div><textarea o-value="this.data.edit.tips"></textarea></div><div class="button" o-tap="addWord">添加关键词</div></div></div></div></div><div class="check-url router-item" route="checkUrl"></div></div></div></div>
    
<!-- 框架script文件 -->
<script src="./static/js/owo.core.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript" charset="UTF-8">
owo.script = {
  "page": {
    "created": function created() {
      var _this = this;

      // 路由器被改变事件
      owo.onViewChange = function () {
        console.log('路由被改变!');

        _this.handleEvent(_this, _this.query('.menu-box'));
      };
    },
    "view": {
      "content": [{
        "data": {
          "sendData": {
            "network": false,
            "pinyin": true,
            "base": true,
            "yange": false,
            "chengyuBase": true,
            "chengyuPinyin": true,
            "mohu": true
          },
          "findList": {},
          "findListArr": [],
          "isSwitchRight": false,
          "infoData": {},
          "activeDom": null
        },
        "getErrorTypeText": function getErrorTypeText(errorCode) {
          switch (errorCode) {
            case 'Polity':
              return '政治';
              break;

            case 'Illegal':
              return '违法';
              break;

            case 'Porn':
              return '色情';
              break;

            case 'Abuse':
              return '粗俗';
              break;

            default:
              return errorCode;
              break;
          }
        },
        "showInfoRight": function showInfoRight() {
          this.query('.info-right').style.display = 'block';
          this.query('.check-right').style.display = 'none';
        },
        "hideInfoRight": function hideInfoRight(e) {
          this.query('.check-right').style.display = 'block';
          this.query('.info-right').style.display = 'none';
        },
        "baseHandle": function baseHandle(htmlData, data) {
          var _this2 = this;

          console.log(htmlData);
          data.forEach(function (item) {
            if (!_this2.data.findList[item['text']]) {
              _this2.data.findList[item['text']] = item;

              _this2.data.findListArr.push(item);

              htmlData = htmlData.replace(new RegExp(item['text'], "gm"), "<span data-ind=\"" + _this2.data.findListArr.length + "\" title=\"\u5173\u952E\u8BCD\u7C7B\u578B: " + _this2.getErrorTypeText(item.type) + "\" class=\"nrsh base " + item.type + "\">" + item['text'] + "</span>");
            }
          });
          return htmlData;
        },
        "pinyinHandle": function pinyinHandle(htmlData, data) {
          var _this3 = this;

          // console.log(data)
          data.forEach(function (item) {
            if (!_this3.data.findList[item['like']]) {
              _this3.data.findList[item['like']] = item;

              _this3.data.findListArr.push(item); // 如果词的类型为政治词语，不一致为错误，其他类型不一致为对应类型


              if (item.type === 'Polity') {
                htmlData = htmlData.replace(new RegExp(item['like'], "gm"), "<span data-ind=\"" + _this3.data.findListArr.length + "\" title=\"\u662F\u5426\u5E94\u8BE5\u5199\u6210: " + item.text + "?\" class=\"nrsh like error\">" + item['like'] + "</span>");
              } else {
                htmlData = htmlData.replace(new RegExp(item['like'], "gm"), "<span data-ind=\"" + _this3.data.findListArr.length + "\" title=\"\u5173\u952E\u8BCD\u7C7B\u578B: " + _this3.getErrorTypeText(item.type) + "\" class=\"nrsh like " + item.type + "\">" + item['like'] + "</span>");
              }
            }
          });
          return htmlData;
        },
        "networkHandle": function networkHandle(htmlData, data) {
          var _this4 = this;

          // console.log(data)
          data.forEach(function (item) {
            if (!_this4.data.findList[item['HitInfo']]) {
              _this4.data.findList[item['HitInfo']] = item;

              _this4.data.findListArr.push(item);

              htmlData = htmlData.replace(new RegExp(item['HitInfo'], "gm"), "<span data-ind=\"" + _this4.data.findListArr.length + "\" class=\"nrsh\">" + item['HitInfo'] + "</span>");
            } else {
              console.log(item['HitInfo'] + " \u5DF2\u88AB\u627E\u51FA\uFF0C\u8DF3\u8FC7\u8BCD\u8BED!");
            }
          });
          return htmlData;
        },
        "reHandleEvent": function reHandleEvent() {
          var _this5 = this;

          // 清理嵌套
          this.queryAll('.nrsh .nrsh').forEach(function (element) {
            element.outerHTML = element.innerText;
          });
          setTimeout(function () {
            _this5.queryAll('.nrsh').forEach(function (element) {
              element.addEventListener("click", function (e) {
                var btnNum = event.button;

                if (btnNum == 2) {
                  console.log('清理');
                } else {
                  // console.log(element)
                  // 生成关键词标签
                  _this5.data.infoData = _this5.data.findList[element.innerText];
                  _this5.data.activeDom = element; // console.log(this.data.infoData)
                  // 对数据进行可视化处理

                  _this5.data.infoData.type = _this5.getErrorTypeText(_this5.data.infoData.type);
                  _this5.data.infoData.major = _this5.data.infoData.major == 1 || _this5.data.infoData.major == '是' ? '是' : '否';

                  if (typeof _this5.data.infoData.pinyin == 'string') {
                    _this5.data.infoData.pinyin = _this5.data.infoData.pinyin.split('|');
                  }

                  setTimeout(function () {
                    _this5.handleEvent(_this5, _this5.query('.info-right'));

                    setTimeout(function () {
                      _this5.showInfoRight();
                    }, 100);
                  }, 100);
                }
              }, false);
            });
          }, 100);
        },
        "check": function check() {
          var _this6 = this;

          // 先清理自己的标记
          this.queryAll('.nrsh').forEach(function (element) {
            element.outerHTML = element.innerText;
          });
          this.data.findList = {};
          this.data.findListArr = [];
          var value = this.query('pre').innerText;

          if (value == '') {
            owo.tool.remind('检查文本不能为空!', 2000);
            return;
          } // console.log(value)


          fetch("http://127.0.0.1:8006/check", {
            method: 'POST',
            body: JSON.stringify({
              "config": this.data.sendData,
              "content": value
            })
          }).then(function (response) {
            return response.json();
          }).then(function (result) {
            var htmlData = _this6.query('pre').innerHTML;

            var data = result['data']; // console.log(htmlData)
            // 先进行基础审查

            htmlData = _this6.baseHandle(htmlData, data['base']);

            if (data['network']) {
              console.log('使用云词库!');
              htmlData = _this6.networkHandle(htmlData, data['network']);
            }

            if (data['pinyin']) {
              console.log('使用拼音匹配!');
              htmlData = _this6.pinyinHandle(htmlData, data['pinyin']);
            }

            if (data['chengyuBase']) {
              console.log('使用成语匹配!');
              htmlData = chengyuBaseHandle(htmlData, data['chengyuBase']);
            }

            if (data['chengyuPinyin'] && data['chengyuPinyin'].length > 0) {
              console.log('使用成语拼音纠错!');
              htmlData = chengyuPinyinHandle(htmlData, data['chengyuPinyin']);
            }

            if (data['regexp'] && data['regexp'].length > 0) {
              console.log('使用正则纠错!');
              htmlData = regexpHandle(htmlData, data['regexp']);
            } // console.log(htmlData)


            _this6.query('pre').innerHTML = htmlData;
            setTimeout(function () {
              _this6.reHandleEvent();
            }, 100);
          })["catch"](function (error) {
            return console.log('error', error);
          });
        },
        "autoFix": function autoFix() {
          console.log(this.data);
          this.data.activeDom.innerText = this.data.infoData.text;
        },
        "clear": function clear() {
          this.data.activeDom.outerHTML = this.data.activeDom.innerText;
          this.hideInfoRight();
        },
        "created": function created() {// 快捷键监测
          // this.$el.onkeydown = function (e) {
          //   let code = e.keyCode
          //   console.log(code)
          // }
        },
        "prop": {
          "route": "checkText"
        },
        "_name": "checkText"
      }, {
        "data": {
          "get18n": {
            "id": "编号",
            "major": "重要标识",
            "relation": "对应文字",
            "text": "关键词",
            "tips": "提示信息",
            "type": "性质"
          },
          "activeTableName": "",
          "edit": {
            "text": "",
            "type": "Polity",
            "major": 0,
            "tips": ""
          }
        },
        "created": function created() {
          this.getData('word');
        },
        "getData": function getData(name) {
          var _this7 = this;

          this.data.activeTableName = name;
          var get18n = this.data.get18n;
          fetch("http://127.0.0.1:8006/getData?name=" + name, {
            method: 'GET',
            redirect: 'follow'
          }).then(function (response) {
            return response.json();
          }).then(function (result) {
            // console.log(result)
            if (result.err == 0) {
              // 取出列
              var newHTML = "<table><thead><tr>";
              var keyList = [];

              for (var key in result.data[0]) {
                if (result.data[0].hasOwnProperty(key) && get18n[key]) {
                  keyList.push(key);
                  newHTML += "<th>" + get18n[key] + "</th>";
                }
              } // 添加工具条


              keyList.push('操作');
              newHTML += "<th>\u64CD\u4F5C</th>";
              newHTML += "</tr></thead><tbody>";
              result.data.forEach(function (element) {
                newHTML += "<tr>";
                keyList.forEach(function (key) {
                  // 如果是type需要做特殊处理
                  if (key == 'type') {
                    newHTML += "<td>" + getErrorTypeText(element[key]) + "</td>";
                  } else if (key == '操作') {
                    newHTML += "<td><span>\u4FEE\u6539</span><span o-tap=\"delete(" + element['id'] + ", '" + element['text'] + "')\">\u5220\u9664</span></td>";
                  } else {
                    newHTML += "<td>" + element[key] + "</td>";
                  }
                });
                newHTML += "</tr>";
              });
              newHTML += "</tbody></table>"; // console.log(newHTML)

              _this7.query('.table-box').innerHTML = newHTML;
              setTimeout(function () {
                _this7.handleEvent(_this7, _this7.query('.info-right'));
              }, 500);
            }
          })["catch"](function (error) {
            return console.log('error', error);
          });
        },
        "delete": function _delete(id, name) {
          var _this8 = this;

          if (confirm("\u786E\u5B9A\u5220\u9664\u5173\u952E\u8BCD\u201C" + name + "\u201D\u5417\uFF1F")) {
            fetch("http://127.0.0.1:8006/getData?name=" + this.data.activeTableName + "&id=" + id, {
              method: 'GET'
            }).then(function (response) {
              return response.json();
            }).then(function (result) {
              if (result.err == 0) {
                _this8.getData(_this8.data.activeTableName);

                alert("\u5173\u952E\u8BCD [" + name + "] \u5DF2\u7ECF\u88AB\u5220\u9664!");
              }
            })["catch"](function (error) {
              return console.log('error', error);
            });
          }
        },
        "addWord": function addWord() {
          console.log(this.data.edit);
        },
        "prop": {
          "route": "word"
        },
        "_name": "word"
      }, {
        "prop": {
          "route": "checkUrl"
        },
        "_name": "checkUrl"
      }]
    }
  }
};
</script>

    <script src="./static/js/base64.js.js" type="text/javascript"  charset="UTF-8"></script>
    <script src="./static/js/main.js" type="text/javascript"  charset="UTF-8"></script>

    <script src="./static/js/remind.js" type="text/javascript"  charset="UTF-8"></script>
  </body>
</html>