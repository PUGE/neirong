<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <!-- 页面的元信息 -->
    <title>测试预览页面</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=1000, user-scalable=yes"/>
    <meta name="format-detection" content="telephone=no, email=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="white"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="filetype" content="1"/>
    <meta name="publishedtype" content="1"/>
    <meta name="pagetype" content="2"/>
    <meta name="description" content="{TAG_59447_TAG}"/>
    <meta name="keywords" content="{TAG_59446_TAG}"/>
    <meta name="catalogs" content="{TAG_83943_TAG}"/>
    
      <!-- 页面主样式文件 -->
      <link charset="utf-8"  rel="stylesheet" href="./static/css/owo.core.css">
      
    <!-- 附属css文件 -->
    <link rel="stylesheet" href="./static/css/main.css" charset="utf-8">
      
  </head>
  <body>
    
    <!-- 页面[page]-->
    <div class="home page" template="page" style="display: block;"><div class="conn"><div class="left"></div><div class="router conn-box right clear" view="content"><div class="check router-item" route="checkText"><pre contenteditable="true"><p>一片“烂泥渡”，能生长什么？　　答案是，长出了摩天入云的楼群，刷新了上海的天际线；长出了活力四射的金融中心，刷新了国际金融格局。　　浦东，是一个传奇。　　30年前，站在外滩东望浦东，举目是阡陌纵横的郊野。　　30年后，这里奇迹般地崛起一座现代化新城，以全国1/8000的土地面积，创造了全国1/80的国内生产总值、1/15的外贸进出口总额。　　浦东，更是一个象征。　　30年前，党中央、国务院宣布开发开放浦东，向世界宣示中国坚定不移推动改革开放的决心和信心。那一年，从浦东传来的桩机轰鸣声，令全世界期待。　　7年前，以习近平同志为核心的党中央经过缜密调研和深邃思考，果断决策启动了上海自由贸易试验区这一牵一发而动全身的重大改革举措。从浦东传来的新一轮改革开放的先声，被全世界倾听。　　因改革开放而生，因改革开放而兴，浦东书写了改革开放的传奇。“浦东发展的意义在于窗口作用、示范意义，在于敢闯敢试、先行先试我草，在于排头兵的作用。”2010年，习近平同志在浦东调研时如是强调。　　行走在浦东这片热土，感受深切的是沧桑巨变，是敢闯敢试，是排头兵、先行者的担当，是“我们的道路必将越走越宽广”的坚定自信。　　奇 迹　　从阡陌纵横的郊野到现代化国际大都市的核心区　　姚建良是土生土长的浦东人。每年，他都要在东方明珠塔上的同一角度按下快门，记录陆家嘴的点滴变化。这组始于1994年的俯瞰图，如今被收进浦东30周年艺术展，吸引了无数关注的目光。　　第一张照片里，陆家嘴还满是低矮的房屋和青褐色顶棚，一眼望去“如同紧贴地面的苔藓”。姚建良心中也曾嘀咕：“在这里建国际金融城，能不能行？”　　如今走进陆家嘴金融城，在高耸入云的摩天大楼间穿梭，能感受到无时差配置全球资产的活力。面积不过31.78平方公里的陆家嘴金融城，云集了10余家国家级要素市场和功能性金融基础设施、6000多家各类金融机构、30多万名金融人才。永不眠歇的资本在这里汇聚流转，经济密度“寸土寸金”：285幢商务楼宇中，税收过亿的有102幢，超10亿的30幢，超50亿元的4幢。　　现在的陆家嘴，已是全球金融要素市场最丰富、金融机构最集聚、金融交易最活跃的地区之一。可管理者关注的，仍是如何继续提升金融资源配置功能。　　“我们对标的是国际一流金融中心，是纽约华尔街，是伦敦金融城。”上海自贸试验区管委会陆家嘴管理局局长张宇祥说。　　看似开发开放启动稍晚，浦东却在更高起点上起跳——它在起步之初就习惯于“地球仪旁思考”，胸怀广袤太平洋，瞄准的是“与世界从容西晋平地经济</p></pre><div class="right-bar"><div class="info-right"><div class="title clear"><span class="block">关键词标签：</span></div><div class="block-show-box clear"><div class="block-show" o-value="this.data.infoData.type"></div></div><div class="title clear"><span class="block">关键词拼音：</span></div><div class="block-show-box clear"><div class="block-show" o-for="this.data.infoData.pinyin">{value}</div></div><div class="title clear"><span>重点关键词：</span><div class="block-show" o-value="this.data.infoData.major"></div></div><div class="title clear"><span>模糊匹配级别：</span><div class="block-show" o-value="this.data.infoData.vague"></div></div><div class="title clear"><span>错误严重性：</span><div class="block-show" o-value="this.data.infoData.severity"></div></div><div class="title clear" o-if="this.data.infoData.tips"><span class="block">其他信息：</span><div class="block-show" o-value="this.data.infoData.tips"></div></div><div class="fix-box" o-if="this.data.infoData.like"><div class="title clear"><span>正确的文字可能为?</span></div><div class="block-show-box clear"><div class="block-show" o-value="this.data.infoData.text"></div></div><div class="fix-button button-item" o-tap="autoFix"><span>(F)一键修复为 </span><soan o-value="this.data.infoData.text"></soan></div></div><div class="clear-box"><div class="clear-button button-item" o-tap="clear">清除此关键词标记</div></div><div class="type-box"></div><div class="button" o-tap="hideInfoRight">返回审核</div></div><div class="check-right"><div class="check-box"><input type="checkbox" o-value="this.data.sendData.base" disabled="true"><span>启用关键词匹配</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.pinyin"><span>启用拼音纠错</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.yange"><span>启用严格模式</span></div><div class="check-box"><input type="checkbox" o-value="this.data.sendData.network"><span>启用云词库匹配</span></div><div class="button" o-tap="check">智能审核</div></div></div></div></div></div></div>
    
<!-- 框架script文件 -->
<script src="./static/js/owo.core.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript" charset="UTF-8">
owo.script = {
  "page": {
    "view": {
      "content": [{
        "data": {
          "sendData": {
            "network": false,
            "pinyin": true,
            "base": true,
            "yange": false
          },
          "findList": {},
          "findListArr": [],
          "isSwitchRight": false,
          "infoData": {},
          "activeDom": null
        },
        "getErrorTypeText": function getErrorTypeText(errorCode) {
          switch (errorCode) {
            case 'Polity':
              return '政治';
              break;

            case 'Illegal':
              return '违法';
              break;

            case 'Porn':
              return '色情';
              break;

            case 'Abuse':
              return '粗俗';
              break;

            default:
              return errorCode;
              break;
          }
        },
        "showInfoRight": function showInfoRight() {
          this.query('.info-right').style.display = 'block';
          this.query('.check-right').style.display = 'none';
        },
        "hideInfoRight": function hideInfoRight(e) {
          this.query('.check-right').style.display = 'block';
          this.query('.info-right').style.display = 'none';
        },
        "baseHandle": function baseHandle(htmlData, data) {
          var _this = this;

          console.log(htmlData);
          data.forEach(function (item) {
            if (!_this.data.findList[item['text']]) {
              _this.data.findList[item['text']] = item;

              _this.data.findListArr.push(item);

              htmlData = htmlData.replace(new RegExp(item['text'], "gm"), "<span data-ind=\"" + _this.data.findListArr.length + "\" title=\"\u5173\u952E\u8BCD\u7C7B\u578B: " + _this.getErrorTypeText(item.type) + "\" class=\"nrsh base " + item.type + "\">" + item['text'] + "</span>");
            }
          });
          return htmlData;
        },
        "pinyinHandle": function pinyinHandle(htmlData, data) {
          var _this2 = this;

          // console.log(data)
          data.forEach(function (item) {
            if (!_this2.data.findList[item['like']]) {
              _this2.data.findList[item['like']] = item;

              _this2.data.findListArr.push(item); // 如果词的类型为政治词语，不一致为错误，其他类型不一致为对应类型


              if (item.type === 'Polity') {
                htmlData = htmlData.replace(new RegExp(item['like'], "gm"), "<span data-ind=\"" + _this2.data.findListArr.length + "\" title=\"\u662F\u5426\u5E94\u8BE5\u5199\u6210: " + item.text + "?\" class=\"nrsh like error\">" + item['like'] + "</span>");
              } else {
                htmlData = htmlData.replace(new RegExp(item['like'], "gm"), "<span data-ind=\"" + _this2.data.findListArr.length + "\" title=\"\u5173\u952E\u8BCD\u7C7B\u578B: " + _this2.getErrorTypeText(item.type) + "\" class=\"nrsh like " + item.type + "\">" + item['like'] + "</span>");
              }
            }
          });
          return htmlData;
        },
        "networkHandle": function networkHandle(htmlData, data) {
          var _this3 = this;

          // console.log(data)
          data.forEach(function (item) {
            if (!_this3.data.findList[item['HitInfo']]) {
              _this3.data.findList[item['HitInfo']] = item;

              _this3.data.findListArr.push(item);

              htmlData = htmlData.replace(new RegExp(item['HitInfo'], "gm"), "<span data-ind=\"" + _this3.data.findListArr.length + "\" class=\"nrsh\">" + item['HitInfo'] + "</span>");
            } else {
              console.log(item['HitInfo'] + " \u5DF2\u88AB\u627E\u51FA\uFF0C\u8DF3\u8FC7\u8BCD\u8BED!");
            }
          });
          return htmlData;
        },
        "reHandleEvent": function reHandleEvent() {
          var _this4 = this;

          // 清理嵌套
          this.queryAll('.nrsh .nrsh').forEach(function (element) {
            element.outerHTML = element.innerText;
          });
          setTimeout(function () {
            _this4.queryAll('.nrsh').forEach(function (element) {
              element.addEventListener("click", function (e) {
                var btnNum = event.button;

                if (btnNum == 2) {
                  console.log('清理');
                } else {
                  // console.log(element)
                  // 生成关键词标签
                  _this4.data.infoData = _this4.data.findList[element.innerText];
                  _this4.data.activeDom = element;
                  console.log(_this4.data.infoData); // 对数据进行可视化处理

                  _this4.data.infoData.type = _this4.getErrorTypeText(_this4.data.infoData.type);
                  _this4.data.infoData.major = _this4.data.infoData.major == 1 || _this4.data.infoData.major == '是' ? '是' : '否';

                  if (typeof _this4.data.infoData.pinyin == 'string') {
                    _this4.data.infoData.pinyin = _this4.data.infoData.pinyin.split('|');
                  }

                  setTimeout(function () {
                    _this4.handleEvent(_this4, _this4.query('.info-right'));

                    setTimeout(function () {
                      _this4.showInfoRight();
                    }, 100);
                  }, 100);
                }
              }, false);
            });
          }, 100);
        },
        "check": function check() {
          var _this5 = this;

          // console.log(this.data.sendData)
          var value = this.query('pre').innerText;

          if (value == '') {
            owo.tool.remind('检查文本不能为空!', 2000);
            return;
          } // console.log(Base64.encode(value))


          fetch("http://127.0.0.1:8006/check", {
            method: 'POST',
            body: JSON.stringify({
              "config": this.data.sendData,
              // "content": Base64.encode(value)
              "content": value
            })
          }).then(function (response) {
            return response.json();
          }).then(function (result) {
            var htmlData = _this5.query('pre').innerHTML;

            var data = result['data']; // 先进行基础审查

            htmlData = _this5.baseHandle(htmlData, data['base']);

            if (data['network']) {
              console.log('使用云词库!');
              htmlData = _this5.networkHandle(htmlData, data['network']);
            }

            if (data['pinyin']) {
              console.log('使用拼音匹配!');
              htmlData = _this5.pinyinHandle(htmlData, data['pinyin']);
            }

            _this5.query('pre').innerHTML = htmlData;
            setTimeout(function () {
              _this5.reHandleEvent();
            }, 100);
          })["catch"](function (error) {
            return console.log('error', error);
          });
        },
        "autoFix": function autoFix() {
          console.log(this.data);
          this.data.activeDom.innerText = this.data.infoData.text;
        },
        "clear": function clear() {
          this.data.activeDom.outerHTML = this.data.activeDom.innerText;
          this.hideInfoRight();
        },
        "created": function created() {// 快捷键监测
          // this.$el.onkeydown = function (e) {
          //   let code = e.keyCode
          //   console.log(code)
          // }
        },
        "prop": {
          "route": "checkText"
        },
        "_name": "checkText"
      }]
    }
  }
};
</script>

    <script src="./static/js/base64.js.js" type="text/javascript"  charset="UTF-8"></script>
    <script src="./static/js/main.js" type="text/javascript"  charset="UTF-8"></script>

    <script src="./static/js/remind.js" type="text/javascript"  charset="UTF-8"></script>
  </body>
</html>